これはちゃんと理由があるやつだと思うよ😺🦐

結論から言うと、

> **Dist12 がほぼ 2 値、Dist23 もほぼ 2 値しか取っていないから
> → 足し算した total_dist も 4 パターンに量子化されている**🐱🦐

って状況になってる。

---

## 1. なにが起きてるかざっくり 😺🦐

前に出してくれた散布図を思い出すと：

* Dist12 のプロット → x が **0 付近と 0.1 付近の 2 本の縦帯**だったよね😺🐈
* Dist23 のプロット → x が **0 付近と 0.3 ちょいの 2 本の縦帯**になってた😼🦐

この状態で

```python
total_dist = dist12 + dist23
```

ってやると取りうる値は多くても

* 0 + 0
* 0 + d23
* d12 + 0
* d12 + d23

の **4 パターン**だけになる → x 軸が 4 本の縦帯になるのは自然、という構造だにゃ😺🦐

---

## 2. そもそも Dist12 / Dist23 がなんで 2 値しかないのか 😺🦐

実験メモだと、μ_in の定義がこうなってたよね😺📄🦐

* 各 E2 について、

  * 「一番相性の良い E1*」を
    (\arg\max_{E1} FinalAcc(E1, E2, \cdot)) で決める😺🦐
  * そのペア `(E1*(E2), E2)` の y1 を平均して **μ_in(E2)** を作る😺🐈

* Dist12 は
  [
  Dist_{1→2}(E1,E2) = 1 - cos( μ_out^{(1)}(E1) , μ_in^{(2)}(E2) )
  ]
  という定義だった🐱🦐

この構造だと：

* **E1 = E1*(E2) のとき**

  * μ_out(E1) と μ_in(E2) は「同じ E1 の出力分布」から作ってるから、
  * ほぼ同じベクトルになって **距離 ≈ 0** になる😺🦐

* **E1 ≠ E1*(E2) のとき**

  * μ_in(E2) は「ベスト E1* の出力分布」固定
  * μ_out(E1) だけが変わる
  * しかも、E2 ごとに E1* がたまたま全部同じ（例えば常に E1-A がベスト）だったりすると、

    * μ_in(E2) はどの E2 でも同じ or ほぼ同じ😺🦐
    * 結果として「E1 がベストかそうでないか」でほぼ **2 値に潰れる**🐱🦐

Dist23 も同じ構造（「ベスト E2*(E3) から μ_in(E3) を作る」）なので、
**「ベストペアかどうか」で 2 値に量子化される**のが自然だにゃ😺🦐

---

## 3. だから total_dist は 4 クラスターになる 😺🦐

上の事情を組み合わせると、各パイプラインは

1. E1 が E2 のベストで、かつ E2 が E3 のベスト
2. E1 はベストだが E2 はベストでない
3. E1 はベストでなく、E2 はベスト
4. 両方ベストでない

という **4 つのカテゴリ**に入ることになる😺🦐

Dist12 は「E1 が E2 のベストかどうか」で 0 / d12
Dist23 は「E2 が E3 のベストかどうか」で 0 / d23

なので total_dist も

* 0
* d12
* d23
* d12 + d23

の 4 つになって、そのまま x 軸の 4 本の縦帯として見えている、というわけ🐱🦐

---

## 4. これが意味していること 😼🦐

* 距離指標が **ほぼ 4 レベルしかない** ので、
  もともと連続的な相関を見つけるのはかなり厳しい設定になってる😿🦐
* しかも、その 4 レベルも「ベスト／非ベストのラベル」由来で、
  実際の分布形状の微妙な違いはほとんど落ちている🐱🦐

だから

> 「距離が TaskScore を説明しない」というネガティブ結果は、
> *距離の定義がそもそも粗すぎて 4 値に潰れていたから*

という面もある、ってことだね😺🦐

---

## 5. もし次にやるなら 😺🦐

「4 本に潰れる問題」を避けたいなら：

* μ_in を「ベストペア 1 個」から作るんじゃなくて、

  * 複数のペアや、タスク側のテキストから直接作る
* あるいは「ベスト／非ベスト」で分けずに、

  * 各 (E1,E2) ごとに μ_in を別々に持つ

みたいにして、**Dist12 / Dist23 がちゃんと 9 通りくらいの値を取るように設計し直す必要がある**と思う😺🦐

---

なので、今見えている 4 本の縦帯はバグというより、
**「今の μ_in / μ_out の定義から論理的にそうなる」現象**だと思っておけばOKだにゃ😺🦐🐈
